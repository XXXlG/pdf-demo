# RAGåˆ‡ç‰‡å®šä½APIæœåŠ¡

è¿™æ˜¯ä¸€ä¸ªåŸºäºFastAPIçš„RAGçŸ¥è¯†åˆ‡ç‰‡å®šä½æœåŠ¡ï¼Œå¯ä»¥ç²¾ç¡®å®šä½RAGåˆ‡ç‰‡åœ¨PDFæ–‡æ¡£ä¸­çš„åæ ‡ä½ç½®ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. å¯åŠ¨æœåŠ¡

```bash
python start_api.py
```

æœåŠ¡å°†åœ¨ `http://localhost:8004` å¯åŠ¨

### 3. è®¿é—®APIæ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- äº¤äº’å¼APIæ–‡æ¡£ï¼šhttp://localhost:80004/docs
- æœåŠ¡çŠ¶æ€ï¼šhttp://localhost:80004/health

## ğŸ“– APIæ¥å£

### 1. `/locate` - å®šä½åˆ‡ç‰‡ä½ç½®

**POST** `/locate`

å®šä½RAGåˆ‡ç‰‡åœ¨æŒ‡å®šPDFæ–‡ä»¶ä¸­çš„æœ€ä½³åŒ¹é…ä½ç½®ã€‚

**è¯·æ±‚ä½“ï¼š**
```json
{
  "chunk_text": "å…ƒå™¨ä»¶å®‰è£…å­”ä¸å…ƒå™¨ä»¶å¼•çº¿ä¸åŒ¹é…",
  "pdf_path": "data/èˆªå¤©ç”µå­äº§å“å¸¸è§è´¨é‡ç¼ºé™·æ¡ˆä¾‹.13610530(2).pdf",
  "similarity_threshold": 0.5
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "page": 15,
  "bbox": [100.5, 200.2, 450.8, 280.1],
  "similarity": 0.87,
  "match_type": "ç›´æ¥æ–‡æœ¬åŒ¹é…",
  "found_text_preview": "å…ƒå™¨ä»¶å®‰è£…å­”ä¸å…ƒå™¨ä»¶å¼•çº¿ä¸åŒ¹é…ï¼Œå¯¼è‡´...",
  "message": "æˆåŠŸå®šä½åˆ°ç¬¬15é¡µ"
}
```

### 2. `/upload` - ä¸Šä¼ PDFå¹¶å®šä½

**POST** `/upload`

ä¸Šä¼ PDFæ–‡ä»¶å¹¶å®šä½åˆ‡ç‰‡ä½ç½®ã€‚

**å‚æ•°ï¼š**
- `chunk_text` (form): åˆ‡ç‰‡å†…å®¹
- `similarity_threshold` (form): ç›¸ä¼¼åº¦é˜ˆå€¼
- `pdf_file` (file): PDFæ–‡ä»¶

### 3. `/analyze` - åˆ†æåˆ‡ç‰‡å†…å®¹

**POST** `/analyze`

åˆ†æåˆ‡ç‰‡å†…å®¹çš„ç‰¹å¾ã€‚

**å‚æ•°ï¼š**
- `chunk_text` (form): è¦åˆ†æçš„åˆ‡ç‰‡å†…å®¹

**å“åº”ï¼š**
```json
{
  "length": 45,
  "sentences": 2,
  "has_numbers": false,
  "complexity_score": 0.35
}
```

### 4. `/health` - å¥åº·æ£€æŸ¥

**GET** `/health`

æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€ã€‚

## ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹

### Pythonå®¢æˆ·ç«¯

```python
import requests

# å®šä½åˆ‡ç‰‡
response = requests.post("http://localhost:80004/locate", json={
    "chunk_text": "ä½ çš„åˆ‡ç‰‡å†…å®¹",
    "pdf_path": "ä½ çš„PDFæ–‡ä»¶è·¯å¾„",
    "similarity_threshold": 0.5
})

result = response.json()
if result["success"]:
    print(f"æ‰¾åˆ°åŒ¹é…ä½ç½®ï¼šç¬¬{result['page']}é¡µ")
    print(f"åæ ‡ï¼š{result['bbox']}")
    print(f"ç›¸ä¼¼åº¦ï¼š{result['similarity']}")
```

### ä½¿ç”¨å®¢æˆ·ç«¯ç¤ºä¾‹

è¿è¡Œå®Œæ•´çš„å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š

```bash
python api_client_example.py
```

äº¤äº’å¼æµ‹è¯•ï¼š

```bash
python api_client_example.py interactive
```

### curl ç¤ºä¾‹

```bash
# å®šä½åˆ‡ç‰‡
curl -X POST "http://localhost:80004/locate" \
     -H "Content-Type: application/json" \
     -d '{
       "chunk_text": "å…ƒå™¨ä»¶å®‰è£…å­”ä¸å…ƒå™¨ä»¶å¼•çº¿ä¸åŒ¹é…",
       "pdf_path": "data/èˆªå¤©ç”µå­äº§å“å¸¸è§è´¨é‡ç¼ºé™·æ¡ˆä¾‹.13610530(2).pdf",
       "similarity_threshold": 0.5
     }'

# å¥åº·æ£€æŸ¥
curl http://localhost:80004/health
```

## ğŸ“‹ å“åº”å­—æ®µè¯´æ˜

### å®šä½å“åº”å­—æ®µ

- `success`: æ˜¯å¦æˆåŠŸå®šä½
- `page`: é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
- `bbox`: åæ ‡è¾¹ç•Œæ¡† `[x0, y0, x1, y1]`
  - `x0, y0`: å·¦ä¸Šè§’åæ ‡
  - `x1, y1`: å³ä¸‹è§’åæ ‡
- `similarity`: ç›¸ä¼¼åº¦åˆ†æ•° (0-1)
- `match_type`: åŒ¹é…ç±»å‹
  - `"ç›´æ¥æ–‡æœ¬åŒ¹é…"`: æ‰¾åˆ°å®Œå…¨åŒ¹é…çš„æ–‡æœ¬
  - `"å…³é”®è¯åŒ¹é…"`: åŸºäºå…³é”®è¯çš„åŒ¹é…
  - `"æ¨¡ç³ŠåŒ¹é…"`: ç›¸ä¼¼åº¦åŒ¹é…
- `found_text_preview`: æ‰¾åˆ°çš„æ–‡æœ¬é¢„è§ˆ
- `message`: å“åº”æ¶ˆæ¯

## âš™ï¸ é…ç½®è¯´æ˜

### ç›¸ä¼¼åº¦é˜ˆå€¼

- èŒƒå›´ï¼š0.0 - 1.0
- é»˜è®¤ï¼š0.5
- å»ºè®®ï¼š
  - `0.7-1.0`: ä¸¥æ ¼åŒ¹é…ï¼Œè¦æ±‚é«˜ç›¸ä¼¼åº¦
  - `0.5-0.7`: å¹³è¡¡åŒ¹é…ï¼Œæ¨èä½¿ç”¨
  - `0.3-0.5`: å®½æ¾åŒ¹é…ï¼Œå¯èƒ½åŒ…å«æ›´å¤šå€™é€‰

### åŒ¹é…ç­–ç•¥

ç³»ç»Ÿæ ¹æ®åˆ‡ç‰‡é•¿åº¦è‡ªåŠ¨é€‰æ‹©åŒ¹é…ç­–ç•¥ï¼š
- **çŸ­æ–‡æœ¬** (< 100å­—ç¬¦): ä½¿ç”¨å¤šç§åŒ¹é…æ–¹æ³•ï¼ŒåŒ…å®¹æ€§æ›´å¼º
- **é•¿æ–‡æœ¬** (â‰¥ 100å­—ç¬¦): ä½¿ç”¨æ•´ä½“åŒ¹é…ï¼Œç²¾ç¡®åº¦æ›´é«˜

## ğŸ”§ å¼€å‘å’Œè°ƒè¯•

### å¯ç”¨è°ƒè¯•æ¨¡å¼

ä¿®æ”¹ `start_api.py` ä¸­çš„ `reload=True` å¯ä»¥å¯ç”¨çƒ­é‡è½½æ¨¡å¼ã€‚

### æŸ¥çœ‹æ—¥å¿—

æœåŠ¡è¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†çš„å¤„ç†æ—¥å¿—ï¼ŒåŒ…æ‹¬ï¼š
- åŒ¹é…ç­–ç•¥é€‰æ‹©
- å…³é”®è¯æå–
- ç›¸ä¼¼åº¦è®¡ç®—è¿‡ç¨‹

### é”™è¯¯å¤„ç†

APIè¿”å›æ ‡å‡†çš„HTTPçŠ¶æ€ç ï¼š
- `200`: æˆåŠŸ
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `404`: æ–‡ä»¶ä¸å­˜åœ¨
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## ğŸ¯ æœ€ä½³å®è·µ

1. **PDFè·¯å¾„**: ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹äºæœåŠ¡å¯åŠ¨ç›®å½•çš„è·¯å¾„
2. **åˆ‡ç‰‡é•¿åº¦**: å»ºè®®50-500å­—ç¬¦ï¼Œè¿‡çŸ­æˆ–è¿‡é•¿éƒ½å¯èƒ½å½±å“åŒ¹é…æ•ˆæœ
3. **ç›¸ä¼¼åº¦é˜ˆå€¼**: ä»0.5å¼€å§‹æµ‹è¯•ï¼Œæ ¹æ®æ•ˆæœè°ƒæ•´
4. **æ–‡ä»¶ä¸Šä¼ **: å¤§æ–‡ä»¶å»ºè®®ä½¿ç”¨ `/locate` æ¥å£è€Œé `/upload`

## ğŸ“ é¡¹ç›®ç»“æ„

```
pdf-demo/
â”œâ”€â”€ api_service.py          # FastAPIæœåŠ¡ä¸»æ–‡ä»¶
â”œâ”€â”€ start_api.py           # æœåŠ¡å¯åŠ¨è„šæœ¬
â”œâ”€â”€ api_client_example.py  # å®¢æˆ·ç«¯ç¤ºä¾‹
â”œâ”€â”€ rag_chunk_locator.py   # æ ¸å¿ƒå®šä½åŠŸèƒ½
â”œâ”€â”€ requirements.txt       # ä¾èµ–åŒ…
â””â”€â”€ data/                  # PDFæ–‡ä»¶ç›®å½•
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£80004æ˜¯å¦è¢«å ç”¨
   - ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…

2. **PDFæ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯**
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤PDFæ–‡ä»¶å¯è¯»

3. **å®šä½å¤±è´¥**
   - å°è¯•é™ä½ç›¸ä¼¼åº¦é˜ˆå€¼
   - æ£€æŸ¥åˆ‡ç‰‡å†…å®¹æ˜¯å¦ç¡®å®åœ¨PDFä¸­
   - ç¡®è®¤PDFæ–‡æœ¬å¯ä»¥æ­£å¸¸æå–

### è·å–å¸®åŠ©

- æŸ¥çœ‹APIæ–‡æ¡£ï¼šhttp://localhost:80004/docs
- è¿è¡Œå¥åº·æ£€æŸ¥ï¼šhttp://localhost:80004/health
- ä½¿ç”¨å®¢æˆ·ç«¯ç¤ºä¾‹è¿›è¡Œæµ‹è¯• 